(function (a) { a.facebox = function (e, f) { a.facebox.loading(); if (e.ajax) c(e.ajax, f); else if (e.image) b(e.image, f); else if (e.div) d(e.div, f); else if (a.isFunction(e)) e.call(a); else a.facebox.reveal(e, f) }; a.extend(a.facebox, { settings: { opacity: .2, overlay: true, loadingImage: "/facebox/loading.gif", closeImage: "/facebox/closelabel.png", imageTypes: ["png", "jpg", "jpeg", "gif"], faceboxHtml: ' <div id="facebox" style="display:none;"> <div class="popup"> <div class="content"> </div> <a href="#" class="close"><img src="/facebox/closelabel.png" title="close" class="close_image" /></a> </div> </div>' }, loading: function () { f(); if (a("#facebox .loading").length == 1) return true; k(); a("#facebox .content").empty(); a("#facebox .body").children().hide().end().append('<div class="loading"><img src="' + a.facebox.settings.loadingImage + '"/></div>'); a("#facebox").css({ top: i()[1] + h() / 10, left: a(window).width() / 2 - 205 }).show(); a(document).bind("keydown.facebox", function (b) { b.keyCode == 27 && a.facebox.close(); return true }); a(document).trigger("loading.facebox") }, reveal: function (c, b) { a(document).trigger("beforeReveal.facebox"); b && a("#facebox .content").addClass(b); a("#facebox .content").append(c); a("#facebox .loading").remove(); a("#facebox .body").children().fadeIn("normal"); a("#facebox").css("left", a(window).width() / 2 - a("#facebox .popup").width() / 2); a(document).trigger("reveal.facebox").trigger("afterReveal.facebox") }, close: function () { a(document).trigger("close.facebox"); return false } }); a.fn.facebox = function (c) { if (a(this).length == 0) return; f(c); function b() { a.facebox.loading(true); var b = this.rel.match(/facebox\[?\.(\w+)\]?/); if (b) b = b[1]; d(this.href, b); return false } return this.bind("click.facebox", b) }; function f(c) { if (a.facebox.settings.inited) return true; else a.facebox.settings.inited = true; a(document).trigger("init.facebox"); g(); var d = a.facebox.settings.imageTypes.join("|"); a.facebox.settings.imageTypesRegexp = new RegExp(".(" + d + ")$", "i"); c && a.extend(a.facebox.settings, c); a("body").append(a.facebox.settings.faceboxHtml); var b = [new Image, new Image]; b[0].src = a.facebox.settings.closeImage; b[1].src = a.facebox.settings.loadingImage; a("#facebox").find(".b:first, .bl").each(function () { b.push(new Image); b.slice(-1).src = a(this).css("background-image").replace(/url\((.+)\)/, "$1") }); a("#facebox .close").click(a.facebox.close); a("#facebox .close_image").attr("src", a.facebox.settings.closeImage) } function i() { var a, b; if (self.pageYOffset) { b = self.pageYOffset; a = self.pageXOffset } else if (document.documentElement && document.documentElement.scrollTop) { b = document.documentElement.scrollTop; a = document.documentElement.scrollLeft } else if (document.body) { b = document.body.scrollTop; a = document.body.scrollLeft } return [a, b] } function h() { var a; if (self.innerHeight) a = self.innerHeight; else if (document.documentElement && document.documentElement.clientHeight) a = document.documentElement.clientHeight; else if (document.body) a = document.body.clientHeight; return a } function g() { var b = a.facebox.settings; b.loadingImage = b.loading_image || b.loadingImage; b.closeImage = b.close_image || b.closeImage; b.imageTypes = b.image_types || b.imageTypes; b.faceboxHtml = b.facebox_html || b.faceboxHtml } function d(d, e) { if (d.match(/#/)) { var g = window.location.href.split("#")[0], f = d.replace(g, ""); if (f == "#") return; a.facebox.reveal(a(f).html(), e) } else if (d.match(a.facebox.settings.imageTypesRegexp)) b(d, e); else c(d, e) } function b(d, c) { var b = new Image; b.onload = function () { a.facebox.reveal('<div class="image"><img src="' + b.src + '" /></div>', c) }; b.src = d } function c(c, b) { a.get(c, function (c) { a.facebox.reveal(c, b) }) } function e() { return a.facebox.settings.overlay == false || a.facebox.settings.opacity === null } function k() { if (e()) return; a("#facebox_overlay").length == 0 && a("body").append('<div id="facebox_overlay" class="facebox_hide"></div>'); a("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity", a.facebox.settings.opacity).click(function () { a(document).trigger("close.facebox") }).fadeIn(200); return false } function j() { if (e()) return; a("#facebox_overlay").fadeOut(200, function () { a("#facebox_overlay").removeClass("facebox_overlayBG"); a("#facebox_overlay").addClass("facebox_hide"); a("#facebox_overlay").remove() }); return false } a(document).bind("close.facebox", function () { a(document).unbind("keydown.facebox"); a("#facebox").fadeOut(function () { a("#facebox .content").removeClass().addClass("content"); a("#facebox .loading").remove(); a(document).trigger("afterClose.facebox") }); j() }) })(jQuery)